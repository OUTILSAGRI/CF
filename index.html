<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Calculateur de Besoins en Semences de Prairies</title>
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,600,700&display=swap" rel="stylesheet">
<!-- FontAwesome pour les icônes du menu -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#6fae4e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<style>
:root {
    --vert-fonce: #365436;
    --vert-clair: #6fae4e;
    --orange: #e57428;
    --gris-fond: #f4f7f5;
    --font-principale: 'Montserrat', Arial, sans-serif;
}
html {
    font-size: clamp(13px, 2.5vw, 17px);
    min-height: 100%;
    box-sizing: border-box;
}
body {
    font-family: var(--font-principale);
    background: var(--gris-fond);
    color: var(--vert-fonce);
    margin: 0;
    padding: 0;
    min-width: 0;
    overflow-x: auto;
    min-height: 100vh;
    padding-bottom: 70px; /* Pour ne pas masquer le contenu par le menu fixe */
    box-sizing: border-box;
}
/* MENU DE NAVIGATION EN BAS TYPE LEBONCOIN - RESPONSIVE */
.main-nav {
    position: fixed;
    left: 0;
    bottom: 0;
    width: 100vw;
    background: #fff;
    box-shadow: 0 -2px 18px rgba(54,84,54,0.13);
    z-index: 100;
    display: flex;
    justify-content: space-around;
    align-items: center;
    height: 62px;
    border-top-left-radius: 18px;
    border-top-right-radius: 18px;
    font-size: 1.12em;
    transition: height 0.2s;
}

.main-nav a {
    flex: 1;
    text-decoration: none;
    padding: 8px 0;
    border-radius: 12px;
    font-weight: bold;
    color: #365436;
    background: none;
    transition: background 0.2s, color 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: inherit;
    min-width: 0;
}

.main-nav a.active, .main-nav a:hover {
    background: #e7fbe2;
    color: var(--vert-clair);
}
.main-nav a i {
    font-size: 1.45em;
    margin-bottom: 1px;
}
.main-nav a[title="Besoins & Coûts"] i {
    margin-right: 0;
    margin-left: 2px;
}

@media (max-width: 600px) {
    html { font-size: 15px; }
    .main-nav {
        height: 54px;
        font-size: 1em;
        border-radius: 16px 16px 0 0;
    }
    .main-nav a i {
        font-size: 1.25em;
    }
    body {
        padding-bottom: 62px;
    }
}
@media (max-width: 400px) {
    html { font-size: 13px; }
    .main-nav {
        height: 48px;
        font-size: 0.95em;
        border-radius: 12px 12px 0 0;
    }
    body {
        padding-bottom: 54px;
    }
}
@media (max-width: 350px) {
    html { font-size: 12px; }
    .main-nav {
        height: 42px;
        font-size: 0.90em;
        border-radius: 9px 9px 0 0;
    }
    body {
        padding-bottom: 48px;
    }
}

/* HEADER corrigé */
.header-box {
    width: 100vw !important;
    max-width: 100vw !important;
    margin: 0 !important;
    border-radius: 0 !important;
    background: #fff;
    box-shadow: 0 4px 18px rgba(54,84,54,0.13);
    display: flex;
    justify-content: center;
    align-items: flex-start; /* logo reste en haut */
    text-align: center;
    padding: 32px 0 0 0; /* padding haut seulement */
    border-bottom: 2px solid #f4f7f5; /* légère séparation visuelle */
}
.header-content {
    max-width: 520px;
    width: 100%;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 16px 16px 16px; /* padding bas pour aérer */
}
.logo-header {
    margin-bottom: 10px;
}
.titre-principal {
    font-size: 1.15rem;
    color: var(--vert-fonce);
    font-weight: 700;
    font-family: 'Montserrat', Arial, sans-serif;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin: 0;
}
@media (max-width: 600px) {
    .header-box {
        padding: 18px 0 0 0;
    }
    .header-content {
        max-width: 98vw;
        padding: 0 4vw 9px 4vw;
    }
    .logo-header {
        width: 55px;
    }
    .titre-principal {
        font-size: 0.93rem;
    }
}

/* TITRES */
h1 {
    background: linear-gradient(90deg, var(--vert-fonce) 70%, var(--vert-clair) 100%);
    color: white;
    padding: clamp(16px, 4vw, 30px) 0 clamp(8px, 2vw, 20px);
    margin-bottom: 0;
    box-shadow: 0 4px 14px rgba(54,84,54,0.08);
    font-size: clamp(1.2rem, 4vw, 2rem);
    text-align: center;
    word-break: break-word;
    font-family: var(--font-principale);
    letter-spacing: 1px;
    font-weight: bold;
    text-transform: uppercase;
    margin-top: 0;
}
h2 {
    border-left: 6px solid var(--orange);
    padding-left: clamp(6px, 2vw, 16px);
    margin-bottom: 2vw;
    color: var(--vert-fonce);
    font-size: clamp(1rem, 2.5vw, 1.3rem);
    word-break: break-word;
    font-family: var(--font-principale);
    letter-spacing: 1px;
    font-weight: bold;
    text-transform: uppercase;
    margin-top: 0;
}

/* CONTAINERS centrés sous le titre */
.container,
#recapitulatif-semis,
#besoins-produits,
#cout-total {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(54,84,54,0.08);
    padding: clamp(10px, 4vw, 24px) clamp(4px, 3vw, 18px);
    margin: 2vw auto 10px;
    max-width: 520px;
    width: 100%;
    box-sizing: border-box;
}

@media (max-width: 600px) {
    .container,
    #recapitulatif-semis,
    #besoins-produits,
    #cout-total {
        max-width: 99vw;
        border-radius: 7px;
        padding: 4vw 2vw;
        margin: 2vw auto 2vw;
    }
    h1 {
        font-size: 1.1rem;
        padding: 3vw 0 2vw 0;
    }
    h2 {
        font-size: 0.97rem;
        padding-left: 2vw;
    }
    .prix-modifiable { width: 52px; }
    .melange-produit {
        margin-bottom: 10px;
        padding-bottom: 4px;
    }
    .form-controls {
        gap: 8px;
    }
    .remise-container {
        max-width: 95vw;
    }
    .main-nav a i {
        font-size: 1.1em;
    }
}
@media (max-width: 400px) {
    h1, h2 {
        font-size: 1rem;
    }
    .container,
    #recapitulatif-semis,
    #besoins-produits,
    #cout-total {
        padding: 2vw 1vw;
    }
}
@media (max-width: 350px) {
    button.modern-button {
        padding: 7px 0;
        font-size: 0.88em;
    }
}

/* FORMULAIRES ET INPUTS */
.form-controls {
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.melange-produit {
    margin-bottom: 14px;
    padding-bottom: 6px;
    border-bottom: 1px dashed #b6e5a6;
}
.container > div,
.container > .calcul-unique,
.container > .calcul-melange {
    margin-bottom: 16px;
}
label {
    font-weight: 600;
    color: var(--vert-fonce);
    display: block;
    margin: 0 0 4px 0;
    font-size: clamp(0.97rem, 1.8vw, 1.1rem);
}
input[type="number"],
input[type="text"] {
    width: 100%;
    padding: clamp(7px, 2vw, 14px);
    border: 2px solid var(--vert-clair);
    border-radius: 5px;
    font-size: clamp(0.99em, 1.8vw, 1.08em);
    font-family: var(--font-principale);
    background: #f7fff6;
    margin-bottom: 6px;
    transition: border-color 0.2s;
    box-sizing: border-box;
}
input:focus {
    border-color: var(--orange);
    outline: none;
}
.suggestions-list {
    border: none !important;
    position: absolute;
    z-index: 10;
    background: #fff;
    width: 100%;
    box-shadow: 0 2px 10px #d3e6cd;
}
.suggestions-list div {
    padding: 10px 12px;
    cursor: pointer;
    color: var(--vert-fonce);
    font-family: var(--font-principale);
}
.suggestions-list div:hover {
    background: var(--vert-clair);
    color: white;
}
.autocomplete-container {
    position: relative;
    width: 100%;
}
button.modern-button {
    background: var(--vert-clair);
    color: white;
    border: none;
    border-radius: 5px;
    font-family: var(--font-principale);
    font-size: clamp(0.92em, 1.8vw, 1.05em);
    font-weight: 600;
    padding: clamp(10px, 3vw, 14px) 0;
    margin: clamp(7px, 2vw, 12px) 0 clamp(5px, 1.5vw, 8px) 0;
    box-shadow: 0 2px 8px rgba(54,84,54,0.08);
    transition: background 0.2s, transform 0.15s;
    cursor: pointer;
    width: 100%;
    max-width: none;
    display: block;
}
button.modern-button:hover {
    background: var(--orange);
    color: #fff;
    transform: translateY(-2px) scale(1.035);
}
button.modern-button.reset-button {
    background: var(--orange);
}
button.modern-button.reset-button:hover {
    background: #b85712;
}
button.modern-button.add-button {
    background: var(--vert-fonce);
}
button.modern-button.add-button:hover {
    background: #4b945a;
}
button.danger-button {
    background: #c82333 !important;
}
button.danger-button:hover {
    background: #a21d28 !important;
}
.supprimer-produit,
.supprimer-recap {
    font-size: 1em;
    padding: 10px 0;
    width: 100%;
    box-sizing: border-box;
}
.recap-row {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: clamp(4px, 1vw, 10px);
    margin-bottom: clamp(7px, 2vw, 12px);
    padding-bottom: clamp(4px, 1vw, 7px);
    border-bottom: 1px solid #d7e4d2;
}
.recap-produit, .recap-melange, .recap-surface, .recap-cout {
    width: 100%;
    min-width: auto;
    font-size: 1em;
}
.recap-cout {
    font-weight: bold;
    color: var(--vert-clair);
}
.prix-modifiable {
    width: clamp(56px, 18vw, 90px);
    padding: clamp(3px, 1.5vw, 7px);
    border: 1.5px solid var(--vert-clair);
    border-radius: 5px;
    margin-left: 6px;
    background: #f7fff6;
    font-size: clamp(0.95em, 1.7vw, 1em);
}
.prix-modifiable-container {
    display: flex;
    align-items: center;
    margin-left: 0;
    margin-top: 4px;
    font-size: 0.98em;
}
.recap-buttons {
    display: flex;
    flex-direction: column;
    width: 100%;
    gap: 8px;
}
.recap-buttons .modern-button {
    width: 100%;
    margin: 5px 0;
}
input[type=number]::-webkit-inner-spin-button, 
input[type=number]::-webkit-outer-spin-button { 
  -webkit-appearance: none;
  margin: 0; 
}
input[type=number] {
    -moz-appearance: textfield;
}
input, button {
    touch-action: manipulation;
}

/* REMISE STYLE */
.remise-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 18px auto 18px auto;
    padding: 12px 0;
    background: #f7fff6;
    border-radius: 9px;
    box-shadow: 0 1px 5px rgba(54, 84, 54, 0.04);
    max-width: 340px;
}
.remise-container label {
    color: var(--vert-fonce);
    font-weight: 700;
    font-size: 1.09em;
    margin-bottom: 6px;
    letter-spacing: 0.5px;
    text-align: center;
}
.remise-container input[type="number"] {
    width: 90px;
    padding: 8px 0;
    border: 2px solid var(--vert-clair);
    border-radius: 7px;
    font-size: 1.08em;
    background: #fff;
    text-align: center;
    margin-bottom: 0;
    transition: border-color 0.2s;
    box-shadow: 0 1px 3px rgba(54, 84, 54, 0.04);
}
.remise-container input[type="number"]:focus {
    border-color: var(--orange);
}

/* SELECT PERSONNALISÉ */
#tc-select {
    width: 100%;
    max-width: 260px;
    padding: clamp(7px, 2vw, 14px) 38px 7px 14px;
    border: 2px solid var(--vert-clair);
    border-radius: 5px;
    font-size: clamp(0.99em, 1.8vw, 1.08em);
    font-family: var(--font-principale);
    background: #f7fff6 url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M4 6L8 10L12 6' stroke='%236fae4e' stroke-[...]
    margin-bottom: 6px;
    transition: border-color 0.2s;
    box-sizing: border-box;
    color: var(--vert-fonce);
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
}
#tc-select:focus {
    border-color: var(--orange);
    background-color: #f0fff0;
    outline: none;
}
#tc-select option {
    color: var(--vert-fonce);
    background: #f7fff6;
    font-family: var(--font-principale);
    font-size: 1em;
}
#tc-select::-ms-expand {
    display: none;
}
html, body {
    width: 100vw !important;
    max-width: 100vw !important;
    min-width: 0 !important;
    box-sizing: border-box;
    overflow-x: hidden !important;
}

/* Blocs principaux, titres et navigation : largeur extensible */
.container,
#recapitulatif-semis,
#besoins-produits,
#cout-total,
.header-box,
.remise-container,
.main-nav,
h1, h2,
.recap-table-container,
.recap-row,
.recap-produit, .recap-melange, .recap-surface, .recap-cout,
.recap-buttons,
.table-input,
.recap-table,
.recap-section-title {
    width: 100vw !important;
    max-width: 100vw !important;
    min-width: 0 !important;
    box-sizing: border-box;
    margin-left: 0 !important;
    margin-right: 0 !important;
}
/* Les éléments restent centrés dans leur bloc grâce à align-items/justify-content ou margin: auto */
@media print {
  #recapitulatif-semis, #besoins-produits, #cout-total, .container {
    width: 100vw !important;
    max-width: 100vw !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
}</style>
</head>
<body>
    <div class="header-box">
  <div class="header-content">
    <img src="logo-agricentre-dumas-3.png" alt="Agricentre Dumas" class="logo-header">
    <span class="titre-principal">Calculateur de Besoins en Semences</span>
  </div>
</div>
<nav class="main-nav">
    <a href="#" id="nav-calcul" class="active" title="Calcul">
        <i class="fa-solid fa-calculator"></i>
    </a>
    <a href="#" id="nav-recap" title="Récapitulatif">
        <i class="fa-solid fa-file-lines"></i>
    </a>
    <a href="#" id="nav-besoins" title="Besoins &amp; Coûts">
        <i class="fa-solid fa-seedling"></i>
        <i class="fa-solid fa-euro-sign"></i>
    </a>
    <a href="#" id="nav-impression" title="Impression PDF">
    <i class="fa-solid fa-file-pdf"></i>
</a>
</nav>
<!-- SECTION 1 : CALCUL -->
<section id="section-calcul">
<div class="container">
    <div class="calcul-unique">
        <h2>Calcul avec un seul produit</h2>
        <label for="produit-unique">Produit:</label>
        <div class="autocomplete-container">
            <input id="produit-unique" type="text" placeholder="Commencez à taper le nom d'un produit..." autocomplete="off" />
            <div id="suggestions-unique" class="suggestions-list"></div>
        </div>
        <div class="produit-info" id="info-produit-unique" style="display: none;">
            <div class="poids-sac-info">
                <div>Poids du sac:</div>
                <span id="poids-sac-unique"></span> kg
            </div>
            <div class="prix-sac">
                <div>Prix du sac:</div>
                <input id="prix-sac-unique" min="0" placeholder="Prix €/sac" step="0.01" type="number"/> €
            </div>
        </div>
        <label for="dose-unique">Dose (kg/ha):</label>
        <input id="dose-unique" min="0" step="0.1" type="number"/>
        <div class="form-controls">
            <label for="surface-unique">Surface (ha):</label>
            <input id="surface-unique" min="0.01" step="0.01" type="number" value="1"/>
            <button class="modern-button" onclick="calculerBesoinUnique()" type="button">Calculer le Besoin</button>
            <button class="modern-button reset-button" onclick="reinitialiserCalculUnique()" type="button">Réinitialiser</button>
        </div>
    </div>
    <div class="calcul-melange">
        <h2>Mélange de plusieurs produits</h2>
        <div id="melange-container">
            <div class="melange-produit">
                <div>
                    <label for="produit-melange-1">Produit 1:</label>
                    <div class="autocomplete-container">
                        <input class="produit-melange" data-index="1" id="produit-melange-1" type="text" placeholder="Commencez à taper le nom d'un produit..." autocomplete="off" />
                        <div id="suggestions-melange-1" class="suggestions-list"></div>
                    </div>
                    <div class="produit-info" id="info-produit-melange-1" style="display: none;">
                        <div class="poids-sac-info">
                            <div>Poids du sac:</div>
                            <span class="poids-sac-melange"></span> kg
                        </div>
                        <div class="prix-sac">
                            <div>Prix du sac:</div>
                            <input class="prix-sac-melange" data-index="1" min="0" placeholder="Prix €/sac" step="0.01" type="number"/> €
                        </div>
                    </div>
                </div>
                <div>
                    <label for="dose-melange-1">Dose (kg/ha):</label>
                    <input class="dose-melange" data-index="1" id="dose-melange-1" min="0" step="0.1" type="number" value="0"/>
                </div>
                <div>
                    <button class="supprimer-produit modern-button" data-index="1" type="button">Supprimer</button>
                </div>
            </div>
        </div>
        <div class="add-button-container">
            <button class="modern-button add-button" id="ajouter-produit-melange" type="button">Ajouter un produit au mélange</button>
            <button class="modern-button reset-button" onclick="reinitialiserMelange()" type="button">Réinitialiser le mélange</button>
        </div>
        <div class="form-controls">
            <label for="surface-melange">Surface (ha):</label>
            <input id="surface-melange" min="0.01" step="0.01" type="number" value="1"/>
            <button class="modern-button" onclick="calculerBesoinMelange()" type="button">Calculer le Besoin</button>
        </div>
    </div>
</div>
</section>

<!-- SECTION 2 : RECAPITULATIF -->
<section id="section-recap" style="display:none;">
    <div id="recapitulatif-semis">
        <h2>Récapitulatif des Intentions de Semis</h2>
        <div class="recap-header-row">
            <div class="recap-head-fields">
                <div>
                    <label for="tc-select">TC :</label>
                    <select id="tc-select">
                        <option value="">-- Sélectionnez --</option>
                        <option value="ANGLEYS Mathias">ANGLEYS Mathias</option>
                        <option value="BAYAR Mustapha">BAYAR Mustapha</option>
                        <option value="DELSUC Olivier">DELSUC Olivier</option>
                        <option value="GUIBERT Blandine">GUIBERT Blandine</option>
                        <option value="LEYE Saliou">LEYE Saliou</option>
                        <option value="PLAS Philippe">PLAS Philippe</option>
                        <option value="TRICAUD Florent">TRICAUD Florent</option>
                    </select>
                </div>
                <div>
                    <label for="exploitation-input">Exploitation :</label>
                    <input id="exploitation-input" placeholder="Nom de la ferme" type="text"/>
                </div>
            </div>
            <div class="recap-head-actions">
                <button class="modern-button reset-button" onclick="reinitialiserRecapitulatif()">Réinitialiser</button>
            </div>
        </div>
        <div class="recap-table-container">
            <div class="recap-section-title">Produits purs</div>
            <table class="recap-table" id="recap-table-purs">
                <thead>
                    <tr>
                        <th>Produit</th>
                        <th>Prix/sac (€)</th>
                        <th>Surface (ha)</th>
                        <th>Dosage (kg/ha)</th>
                        <th>Coût/ha (€)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="recap-content-purs">
                    <!-- JS: lignes produits purs ici -->
                </tbody>
            </table>
            <div class="recap-section-title">Mélanges</div>
            <table class="recap-table" id="recap-table-melanges">
                <thead>
                    <tr>
                        <th>Produit</th>
                        <th>Prix/sac (€)</th>
                        <th>Surface (ha)</th>
                        <th>Dosage (kg/ha)</th>
                        <th>Coût/ha (€)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="recap-content-melanges">
                    <!-- JS: lignes mélanges ici -->
                </tbody>
            </table>
        </div>
    </div>
</section>

<!-- SECTION 3 : BESOINS -->
<section id="section-besoins" style="display:none;">
    <div class="remise-container">
      <label for="remise-besoins">Remise sur total (%) :</label>
      <input type="number" id="remise-besoins" min="0" max="100" step="0.01" value="0">
    </div>
    <div id="besoins-produits">
        <h2>Besoins en Produits</h2>
        <div id="besoins-content"></div>
    </div>
    <div id="cout-total">
        <h2>Coût Total</h2>
        <div id="cout-content"></div>
    </div>
</section>

<!-- SECTION 4 : Impression -->
<section id="section-impression" style="display:none;">
    <div class="container">
        <h2>Impression personnalisée</h2>
        <form id="form-impression">
            <div>
                <label>
                    <input type="checkbox" name="recap" checked>
                    Récapitulatif des intentions de semis
                </label>
            </div>
            <div>
                <label>
                    <input type="checkbox" name="besoins" checked>
                    Besoin en produit
                </label>
            </div>
            <div>
                <label>
                    <input type="checkbox" name="cout" checked>
                    Coût total
                </label>
            </div>
            <button id="creer-pdf" class="modern-button">Créer le PDF</button>
        </form>
    </div>
</section>

<script>
// Pour activer le recalcul automatique sur changement de remise
document.addEventListener('DOMContentLoaded', function() {
    var remiseElt = document.getElementById('remise-besoins');
    if(remiseElt) remiseElt.addEventListener('input', function() {
        if(typeof afficherBesoinsProduits === "function") afficherBesoinsProduits();
    });
});
</script>
<script src="app.js"></script>
</body>
</html>